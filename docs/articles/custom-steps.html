<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Developer info: Writing custom steps • tic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Developer info: Writing custom steps">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.13.9010</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advantages.html">Why you should use tic</a>
    </li>
    <li>
      <a href="../articles/build-lifecycle.html">The CI build lifecycle</a>
    </li>
    <li>
      <a href="../articles/tic-usethis-travis.html">tic, travis and usethis</a>
    </li>
    <li>
      <a href="../articles/advanced.html">Advanced usage</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deployment</a>
    </li>
    <li>
      <a href="../articles/custom-steps.html">Custom steps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropenscilabs/tic">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Developer info: Writing custom steps</h1>
                        <h4 class="author">Kirill Müller</h4>
            
      
      <!--The 'toc' block was inserted manually by @pat-s. It triggeres the inline ToC in the vignettes.-->
            <div id="toc">
      <h3 class="hasAnchor">
<a href="#toc" class="anchor"></a>Table of Contents</h3>
      <ul>
<li><a href="#public-methods-of-the-ticstep-class">Public methods of the <code>TicStep</code> class</a></li>
      <li><a href="#further-information-on-the-r6-class-system">Further information on the R6 class system</a></li>
      </ul>
</div>
      
      <small>Source: <a href="https://github.com/ropenscilabs/tic/blob/master/vignettes/custom-steps.Rmd"><code>vignettes/custom-steps.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<p>Many important steps running on CI systems are <a href="tic.html#steps">already implemented</a> into <em>tic</em>. The following vignette shows how new steps can be created and how <em>tic</em> defines them. Internally, all steps are defined using the <a href="https://github.com/wch/R6">R6</a> class system. For more information see on object-oriented programming using R6 see <a href="https://adv-r.hadley.nz/r6.html">this chapter</a> in <a href="https://adv-r.hadley.nz/">Advanced R</a>. A step is an environment-like (or list-like) object with named elements <code>check</code>, <code>prepare</code>, and <code>run</code>. These members should be functions that are callable without arguments.</p>
<p>The base class of a step that is <code>TicStep</code>. All steps defined by tic, including the example <code>HelloWorld</code> step, use <code>TicStep</code> as the base class. See <a href="https://github.com/ropenscilabs/tic/blob/master/R/steps-base.R"><code>steps-base.R</code></a> for the implementation. This means that you only need to override the methods you need; if you don’t need a <code><a href="https://www.rdocumentation.org/packages/utils/topics/PkgUtils">check()</a></code> or <code>prepare()</code> method you can leave it out. The <code>step_...</code> functions in tic are simply forwarded to the <code>new()</code> methods of the corresponding R6 class objects (and from there to <code>initialize()</code> member functions). We recommend following the same pattern for your custom steps.</p>
<p>There should be no need to write steps on your own. However, if you have the need for a repeated use of specific combinations of <code><a href="../reference/DSL.html">add_code_step()</a></code>, please let us know so in the repo by opening an <a href="https://github.com/ropenscilabs/tic/issues">issue</a> so that we can discuss whether it makes sense to implement it as a custom step.</p>
<div id="public-methods-of-the-ticstep-class" class="section level2">
<h2 class="hasAnchor">
<a href="#public-methods-of-the-ticstep-class" class="anchor"></a>Public methods of the <code>TicStep</code> class</h2>
<p>The <code>TicStep</code> class is the main class that is inherited by all <code>step_xxx</code> functions. It has three public methods. Two of them (<code>prepare()</code> and <code>run()</code>) must be overriden by the new step class. The third one (<code><a href="https://www.rdocumentation.org/packages/utils/topics/PkgUtils">check()</a></code>) is optional.</p>
<div id="prepare" class="section level3">
<h3 class="hasAnchor">
<a href="#prepare" class="anchor"></a><code>prepare()</code>
</h3>
<p>This method will be called by <code><a href="../reference/prepare_all_stages.html">prepare_all_stages()</a></code>. It is intended to run in the <code>before_script</code> phase of the CI run. This method should install all dependent packages that the step requires, which then can be cached by the CI system. You also may include further preparation code here. For example <code>step_rcmdcheck</code> verifies that the R packages <em>rcmdcheck</em> and <em>remotes</em> are installed:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">RCMDcheck<span class="op">$</span>public_methods<span class="op">$</span>prepare</a></code></pre></div>
</div>
<div id="run" class="section level3">
<h3 class="hasAnchor">
<a href="#run" class="anchor"></a><code>run()</code>
</h3>
<p>This method executes the step. When a step is added to a stage, <code>run()</code> will be called when the stage is executed. For example, the <code>run()</code> function of class <code>RCMDcheck</code> looks as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">RCMDcheck<span class="op">$</span>public_methods<span class="op">$</span>run</a></code></pre></div>
</div>
<div id="check" class="section level3">
<h3 class="hasAnchor">
<a href="#check" class="anchor"></a><code><a href="https://www.rdocumentation.org/packages/utils/topics/PkgUtils">check()</a></code>
</h3>
<p>This method checks whether the step is actually run. It returns a logical scalar. Note that not all steps need to have a <code><a href="https://www.rdocumentation.org/packages/utils/topics/PkgUtils">check()</a></code> method. Steps that do have a <code><a href="https://www.rdocumentation.org/packages/utils/topics/PkgUtils">check()</a></code> method are:</p>
<ul>
<li>All ssh steps defined in <a href="https://github.com/ropenscilabs/tic/blob/master/R/steps-ssh.R"><code>step-ssh.R</code></a>
</li>
<li><a href="https://github.com/ropenscilabs/tic/blob/457a5d259c6861e322220ac51a0436436e5f214b/R/steps-git.R#L187-L217"><code><a href="../reference/step_do_push_deploy.html">step_do_push_deploy()</a></code></a></li>
<li><a href="https://github.com/ropenscilabs/tic/blob/457a5d259c6861e322220ac51a0436436e5f214b/R/steps-git.R#L319-L359"><code><a href="../reference/step_push_deploy.html">step_push_deploy()</a></code></a></li>
<li><a href="https://github.com/ropenscilabs/tic/blob/457a5d259c6861e322220ac51a0436436e5f214b/R/steps-write-text-file.R#L1-L24"><code><a href="../reference/step_write_text_file.html">step_write_text_file()</a></code></a></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">WriteTextFile<span class="op">$</span>public_methods<span class="op">$</span>check</a></code></pre></div>
<p>You can take a look at <a href="https://github.com/ropenscilabs/tic/pull/75/files">this PR</a> to see how a new step implementation can look like.</p>
<p>The most minimalist version is the “Hello World” <a href="https://github.com/ropenscilabs/tic/blob/master/R/steps-base.R">example step</a>. This new class only contains a <code>run()</code> method which does nothing more than printing “Hello World” to the console. It is initialized by calling <code><a href="../reference/step_hello_world.html">step_hello_world()</a></code> which creates a new instance of this class.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">HelloWorld &lt;-<span class="st"> </span><span class="kw">R6Class</span>(</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="st">"HelloWorld"</span>, <span class="dt">inherit =</span> TicStep,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">public =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="dt">run =</span> <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="st">"Hello, world!"</span>)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#' Step: Hello, world!</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#'</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#' The simplest step possible: prints "Hello, world!" to the console when run, does not require</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#' any preparation.</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#' This step may be useful to test a \pkg{tic} setup or as a starting point when implementing a</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#' custom step.</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#'</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#' @family steps</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#' @export</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20">step_hello_world &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb4-21" data-line-number="21">  HelloWorld<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb4-22" data-line-number="22">}</a></code></pre></div>
</div>
</div>
<div id="further-information-on-the-r6-class-system" class="section level1">
<h1 class="hasAnchor">
<a href="#further-information-on-the-r6-class-system" class="anchor"></a>Further information on the R6 class system</h1>
<p>If you are unfamiliar with <code>R6</code> classes, here is a short guidance how the arguments are passed onto each function: Consider the <code><a href="../reference/step_rcmdcheck.html">step_rcmdcheck()</a></code> function (<a href="https://github.com/ropenscilabs/tic/blob/master/R/steps-rcmdcheck.R">link to source</a>):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">step_rcmdcheck &lt;-<span class="st"> </span><span class="cf">function</span>(...,</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                           <span class="dt">warnings_are_errors =</span> <span class="ot">NULL</span>, <span class="dt">notes_are_errors =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                           <span class="dt">args =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"--no-manual"</span>, <span class="st">"--as-cran"</span>),</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                           <span class="dt">build_args =</span> <span class="st">"--force"</span>, <span class="dt">error_on =</span> <span class="st">"warning"</span>,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                           <span class="dt">repos =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/options">getOption</a></span>(<span class="st">"repos"</span>), <span class="dt">timeout =</span> <span class="ot">Inf</span>) {</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  RCMDcheck<span class="op">$</span><span class="kw">new</span>(</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    <span class="dt">warnings_are_errors =</span> warnings_are_errors,</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    <span class="dt">notes_are_errors =</span> notes_are_errors,</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    <span class="dt">args =</span> args,</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">    <span class="dt">build_args =</span> build_args,</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">    <span class="dt">error_on =</span> error_on,</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">    <span class="dt">repos =</span> repos,</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">    <span class="dt">timeout =</span> timeout</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">  )</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">}</a></code></pre></div>
<p>Here, a new instance of the defined <code>R6</code> class <code>RCMDcheck</code> is initiated with <code>RCMDcheck$new()</code>. The arguments to <code><a href="../reference/step_rcmdcheck.html">step_rcmdcheck()</a></code> are passed on to the <code>initialize()</code> function of the <code>R6</code> class. Here, the arguments are assigned to the “private” members (e.g. <code>private$args</code>). Next, these private members are used in the <code>run()</code> function which carries out the actual work.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#public-methods-of-the-ticstep-class">Public methods of the <code>TicStep</code> class</a></li>
      <li><a href="#further-information-on-the-r6-class-system">Further information on the R6 class system</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kirill Müller, Mika Braginsky, Karthik Ram, Jeroen Ooms, Patrick Schratz, rOpenSci.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
